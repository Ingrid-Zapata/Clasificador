<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clasificación de Imágenes</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <h1>Clasificación de Imágenes</h1><img src="LogotipoSimple.jpg" alt="Clasificación de Imágenes"
            class="project-image" alt="" width="80" height="80">
        <nav>
            <ul>
                <li><a href="#" onclick="showTab('home')">Inicio</a></li>
                <li><a href="#" onclick="showTab('info')">Información</a></li>
                <li><a href="#" onclick="showTab('clasificador')">Clasificador</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Sección de Inicio -->
        <section id="home" class="tab-content">
            <h2>Bienvenido a Clasificación de Imágenes</h2>

            <p>Este proyecto utiliza inteligencia artificial para clasificar imágenes en tiempo real. Utilizando la
                cámara de tu dispositivo, podrás identificar diferentes tipos de animales y mucho más.</p>
        </section>

        <!-- Sección de Información -->
        <section id="info" class="tab-content" style="display: none;">
            <h2>Información del Proyecto</h2>
            <p>El sistema de clasificación de imágenes permite realizar el análisis de fotografías en tiempo real. Es
                una herramienta educativa y entretenida que emplea modelos de machine learning para identificar objetos
                y animales en las imágenes. El objetivo principal es facilitar el aprendizaje sobre clasificación de
                imágenes mediante el uso de tecnología avanzada.</p>
        </section>

        <!-- Sección de Clasificador -->
        <section id="clasificador" class="tab-content" style="display: none;">
            <div class="camera-section">
                <video id="camera" autoplay playsinline width="300" height="200"></video>
                <p>Clasificando cada 2 segundos...</p>
            </div>
            <div class="info-section" id="results">
                <h2>Resultados</h2>
                <p id="loading-message">Espere un momento mientras se cargan los datos...</p>
                <div id="animal-info"></div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Clasificación de Imágenes</p>
    </footer>

    <script>
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.style.display = 'none');
            document.getElementById(tabId).style.display = 'block';
        }

        async function setupCamera() {
            const video = document.getElementById('camera');
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;

            setInterval(captureAndClassify, 2000);
        }

        async function captureAndClassify() {
            const video = document.getElementById('camera');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = canvas.toDataURL('image/jpeg').split(',')[1];

            document.getElementById('loading-message').style.display = 'block';

            try {
                const response = await fetch('http://127.0.0.1:55000/classify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: imageData })
                });

                if (!response.ok) {
                    throw new Error('Error al clasificar la imagen: ' + response.statusText);
                }

                const result = await response.json();
                displayResults(result);
            } catch (error) {
                console.error('Error al enviar la imagen al servidor:', error);
            }
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('animal-info');
            resultsDiv.innerHTML = '';

            document.getElementById('loading-message').style.display = 'none';

            results.forEach(result => {
                const p = document.createElement('p');
                p.textContent = `${result.label}: ${Math.round(result.probability * 100)}%`;
                resultsDiv.appendChild(p);
            });
        }

        setupCamera();
    </script>
</body>

</html>